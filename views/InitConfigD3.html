<md-dialog ng-controller="DiginD3Ctrl"
           class="d3-dialog overflow-none">
    <md-toolbar>
        <div class="card-head">
            <header class="text-color-white">CONFIGURATION</header>
            <div class="tools">
                <a href="javascript:void(0)" ng-click="cancel()">
                    <i class="ti-close  text-color-white"></i>
                </a>
            </div>
        </div>
    </md-toolbar>

    <div class="d3-body-wrap">
        <md-content class="md-padding overflow-none">
            <md-tabs class="overflow-none" md-dynamic-height="" md-border-bottom="">
                <md-tab class="tabs-header-colo overflow-none" label="Visualization">
                    <md-content class="md-padding overflow-none">
                        <!-- <section data-ng-show="error"> -->
                        <section data-ng-show="error">
                            <div class="container">
                            </div>
                        </section>
                        <!-- <section class="" data-ng-show="!error && data.length"> -->
                        <section>
                            <div class="container">
                                <div class="d3-wrap">
                                    <h3 id="layout" class="graph-h2">
                                        Choose a d3 visualization
                                    </h3>
                                    <div class="row">
                                        <div class="col-lg-12 col-md-12">
                                            <div class="chart-description">
                                                <h5 class="graph-h5 f-weight-500">{{chart.title()}}</h5>
                                                <span class="divide-line-b"></span>
                                                <p class="light" ng-bind-html="chart.description()"></p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-lg-12 col-md-12">
                                            <div ng-repeat="category in categories">
                                                <h5 class="text-muted graph-h5">{{category}}</h5>
                                                <div class="row" group every="3" watch="charts">
                                                    <div class="col-lg-4 col-md-4"
                                                         ng-repeat="c in filtered = (charts | categoryFilter:category) track by $index">
                                                        <div ng-class="{selected: c == chart}" class="layout">
                                                            <div class="layout-thumb"
                                                                 ng-style="{'background-image':'url(' + c.thumbnail() + ')'}">
                                                            </div>
                                                            <p class="layout-inner">
                                                                <span class="layout-title">{{c.title()}}</span>
                                                            </p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <!-- end of group -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>
                    </md-content>
                </md-tab>
                <md-tab label="Data">
                    <md-content class="md-padding">
                        <div class="">
                            <div class="col-lg-12">
                                <div class="row">
                                    <div class="col-lg-6">
                                        <h3 id="data" class="graph-h2 m-b-0">Select your data</h3>
                                    </div>
                                    <div class="col-lg-6">
                                     <span class="list-type pull-right">
                                         <a ng-if="isLoadingTbl">
                                             <i class="type fa fa-circle-o-notch fa-spin breath-left m-l-10"
                                             ></i>
                                         </a>
                                        <i class="type fa fa-align-left breath-left"
                                           data-toggle="tooltip"
                                           data-title="Text"
                                           ng-click="dataView='text'" ng-class="{selected:dataView != 'table'}"></i>
                                        <i class="type fa fa-table breath-left"
                                           data-toggle="tooltip"
                                           data-title="Table"
                                           ng-click="dataView='table'" ng-class="{selected:dataView == 'table'}"></i>
                                      </span>
                                    </div>
                                </div>
                            </div>
                            <span class="clearfix"></span>
                            <div class="container d3-wrap m-t-0">

                                <div class="row">
                                    <div class="d3-select-wrap paper p-10">
                                        <div class="col-lg-4">
                                            <md-select class="full-width m-t-0"
                                                       placeholder="Select Source"
                                                       id="source"
                                                       ng-model="source"
                                                       ng-change="onChangeSource(source)"
                                                       md-on-open="loadingDataSource()">
                                                <md-option ng-value="source.name"
                                                           ng-repeat="source in datasources">
                                                    {{source.name}}
                                                </md-option>
                                            </md-select>
                                        </div>
                                        <div class="col-lg-4">
                                            <md-select class="full-width m-t-0"
                                                       placeholder="Select Table"
                                                       ng-change="onChangeTable(item)"
                                                       ng-model="item">
                                                <md-option ng-value="item" ng-repeat="item in dataTables">
                                                    {{item}}
                                                </md-option>
                                            </md-select>
                                        </div>
                                        <div class="col-lg-4">
                                            <div class="d3-action pull-right inline-flex">
                                                <md-button md-no-ink class="md-primary"
                                                           ng-click="onClickConvertCSV()">
                                                    Convert CSV
                                                </md-button>
                                                <md-button md-no-ink class="md-warn"
                                                           ng-click="clearSource()"
                                                >
                                                    <i class="ti-trash"></i>
                                                </md-button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="d3-data-view">
                                        <div class="col-lg-6">
                                            <div class="d3-filed-view">
                                                <div class="d3-loading-filed"
                                                     ng-if="isLoadingFiled">
                                                    <h2 class="graph-h2">Loading...</h2>
                                                </div>
                                                <div ng-repeat="item in tableFiled track by $index">
                                                    <md-checkbox ng-click="selectedFiled(item, selected)">
                                                        {{ item }}
                                                    </md-checkbox>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-lg-6">
                                        <textarea ui-codemirror="codeMirrorOptions"
                                                  ng-model="text">
                                         </textarea>
                                        </div>
                                    </div>
                                </div>
                                <div DiginD3Table class="data-table" data-ng-show="dataView == 'table'"></div>
                            </div>
                            </section>
                        </div>
                    </md-content>
                </md-tab>
                <md-tab label="Mapping" ng-click="selectMapping()">
                    <md-content class="md-padding">
                        <!-- <section class="dark" data-ng-show="!error && data.length"> -->
                        <section class="dark">
                            <div class="container d3-wrap">
                                <div id="mapping" class="row-fluid">
                                    <div>
                                        <h3>Map your Dimensions
                                            <a data-toggle="tooltip"
                                               data-title="Clear all"
                                               ng-click="model.clear()" class="pull-right light"><i
                                                    class="fa fa-trash-o"></i></a>
                                            <span class="clearfix"></span>
                                        </h3>
                                    </div>
                                    <div class="row">
                                        <div class="col-lg-3 col-md-3">
                                            <div draggable>
                                                <ul class="list-unstyled dimensions-list">
                                                    <li class="dimension" data-dimension="{{dimension}}"
                                                        ng-repeat="dimension in metadata track by $index">
                                                        <span class="dimension-key">{{ dimension.key }}</span>
                                                        <span class="dimension-type">{{dimension.type}}</span>
                                                    <span class="dimension-icon pull-right"><i
                                                            class="fa fa-bars"></i></span>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                        <div class="col-lg-9 col-md-9">
                                            <div class="sticky">
                                                <div class="row" group every="3" watch="model">
                                                    <div class="col-lg-4 col-md-4 dimensions-wrapper"
                                                         ng-repeat="dimension in model.dimensions().values() track by $index"
                                                         ng-init="open=false">
                                                        <div class="dimensions-model">
                                                            <!--<div class="dimension-multiple">

                        <i class="fa fa-tag"
                        data-toggle="tooltip"
                        data-title="You can drag only one dimension here"
                        data-ng-show="!dimension.multiple()"></i>

                        <i class="fa fa-tags"
                        data-toggle="tooltip"
                        data-title="You can drag more than one dimension here"
                        data-ng-show="dimension.multiple()"></i>
                      </div>-->
                                                            <i class="fa fa-asterisk dimension-required"
                                                               data-toggle="tooltip" data-title="Required"
                                                               data-ng-show="dimension.required()"></i>
                                                            <!--<a class="dimension-info"
                      data-toggle="tooltip"
                      data-title="Show description"
                      ng-click="open = !open" ng-show="dimension.description()">
                      <i class="fa fa-info dimension-info-toggle"></i>
                      </a>-->
                                                            <p class="dimension-title">{{dimension.title()}}</p>
                                                            <ul sortable title="dimension.title()"
                                                                value="dimension.value"
                                                                multiple="dimension.multiple()"
                                                                types="dimension.types()"
                                                                class="dimensions-container list-unstyled">
                                                            </ul>
                                                        </div>
                                                        <!--<div class="text-muted small" ng-show="dimension.required() && dimension.required() - dimension.value.length > 0">
                  {{dimension.required() - dimension.value.length}} more dimension(s) required
                </div>-->
                                                    </div>
                                                </div>
                                            </div>
                                            <!--<div class="text-muted" ng-show="!model.isValid()" ng-bind-html="model.instruction()"></div>-->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>
                    </md-content>
                </md-tab>
                <md-tab label="Customization">
                    <md-content class="md-padding">
                        <!-- <section class="" data-ng-show="!error && data.length"> -->
                        <section class="">
                            <div class="container d3-wrap">
                                <h3 id="options">
                                    Customize your Visualization
                                </h3>
                                <div class="row">
                                    <div class="col-lg-3">
                                        <ul class="list-unstyled">
                                            <li ng-repeat="option in chart.options() track by $index" chart-option>
                                                <p class="option-title">
                                                    {{option.title()}}
                                                    <a data-ng-show="option.fitToWidth()" data-toggle="tooltip"
                                                       data-title="Fit to width" class="option-fit pull-right"><i
                                                            class="fa fa-expand"></i></a>
                                                </p>
                                                <div ng-switch="" on="option.type()">
                                                    <input type="number" min="0" class="form-control"
                                                           ng-model="option.value" ng-switch-when="number"/>
                                                    <div ng-switch-when="checkbox">
                                                        <label class="checkbox">
                                                            <input type="checkbox" ng-model="option.value"/>
                                                        </label>
                                                    </div>
                                                    <div colors="option.value" ng-switch-when="color"></div>
                                                    <button type="button" class="btn btn-default"
                                                            ng-model="option.value"
                                                            ng-change="$apply()"
                                                            ng-options="opt for opt in option.values()"
                                                            bs-select ng-switch-when="list">
                                                        Action <span class="caret"></span>
                                                    </button>
                                                    <input type="text" min="0" class="form-control"
                                                           ng-model="option.value"
                                                           ng-switch-default="ng-switch-default"/>
                                                </div>
                                            </li>
                                        </ul>
                                    </div>
                                    <div class="col-lg-9">
                                        <div class="chart-resize">
                                            <div id="chart" chart></div>
                                        </div>
                                        <h4><span ng-bind-html="model.instruction()"></span></h4>
                                    </div>
                                </div>
                            </div>
                        </section>
                    </md-content>
                </md-tab>
            </md-tabs>
        </md-content>
    </div>


    <div class="d3-footer">
        <div class="d3-action pull-right">
            <md-button md-no-ink class="md-primary"
                       ng-click="cancel()">
                Cancel
            </md-button>
            <md-button md-no-ink class="md-primary"
                       ng-click="setPlugin()">
                Finish
            </md-button>
        </div>

    </div>


</md-dialog>
